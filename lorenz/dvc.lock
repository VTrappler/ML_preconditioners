schema: '2.0'
stages:
  generate_data:
    cmd: python3.10 /home/prec_data/data_generation.py --config /home/smoke/config.yaml
    deps:
    - path: ../prec_data/data_generation.py
      md5: da8a2b9ec578b42827bf53b02610227e
      size: 3647
    params:
      config.yaml:
        data.data_folder: /root/raw_data/data_100_large
        data.nsamples: 20000
        model.dimension: 100
        model.window: 10
    outs:
    - path: /root/raw_data/data_100_large/tlm.memmap
      md5: 1bc453820c1f9ed0017a8a7190654970
      size: 8000000000
    - path: /root/raw_data/data_100_large/x.memmap
      md5: ca26b5b4725349ce9f058417308960b6
      size: 8000000
  train:
    cmd: source /home/GNlearning/.set_environment_variables.sh && python3.10 /home/GNlearning/lorenz/training.py
      --config config.yaml --exp-name smoke_train_tr
    deps:
    - path: ../prec_data/data.py
      md5: 5a4f754e59a2202ad6284151222ab4ee
      size: 13442
    - path: config.yaml
      hash: md5
      md5: 8d4d5cd5045604148878deb449f33f6b
      size: 697
    - path: training.py
      hash: md5
      md5: c6d4f9d8de340e625697ca2bbbca8ffa
      size: 7842
    params:
      config.yaml:
        architecture.batch_size: 32
        architecture.class: SVDConvolutional
        architecture.n_layers: 8
        architecture.rank: 100
        data.data_folder: /home/data/data_data_assimilation/data_100_large
        model.dimension: 100
        optimizer.epochs: 100
    outs:
    - path: artifacts/metrics.yaml
      hash: md5
      md5: aa154c282e41c568f5df1f53e3471641
      size: 348
    - path: artifacts/mlflow_run_id.yaml
      hash: md5
      md5: c8e8230981775d33387ac84d35edbb14
      size: 233
    - path: artifacts/training_logs.csv
      hash: md5
      md5: 1ca6afd085dd14c115338123f1755d96
      size: 114411
  data_assim:
    cmd: source /home/GNlearning/.set_environment_variables.sh && python3.10 data_assimilation_benchmark_wip.py
      --config config.yaml --run-id-yaml /home/GNlearning/lorenz/artifacts/mlflow_run_id.yaml
    deps:
    - path: artifacts/mlflow_run_id.yaml
      hash: md5
      md5: c8e8230981775d33387ac84d35edbb14
      size: 233
    - path: artifacts/training_logs.csv
      hash: md5
      md5: 1ca6afd085dd14c115338123f1755d96
      size: 114411
    - path: config.yaml
      hash: md5
      md5: 8d4d5cd5045604148878deb449f33f6b
      size: 697
    - path: data_assimilation_benchmark_wip.py
      hash: md5
      md5: 15ade7324e48f60d76c61b841aaae989
      size: 18642
    params:
      config.yaml:
        DA.n_cycle: 20
        DA.n_inner: 50
        DA.n_outer: 3
        model.window: 10
    outs:
    - path: artifacts/DA_logs.csv
      hash: md5
      md5: b2cbc6383d56674250c2b71430990f95
      size: 49137
    - path: artifacts/cond_niter_boxplot.png
      hash: md5
      md5: de690baa290e3b6e5c0085df3f65951d
      size: 34800
    - path: artifacts/res_inner_loop.png
      hash: md5
      md5: ae36a13b67b58e4f392ce4c442211b5c
      size: 323285
  test:
    cmd: source /home/GNlearning/.set_environment_variables.sh &&  python3.10 test.py
      --run-id-yaml /home/GNlearning/lorenz/artifacts/mlflow_run_id.yaml
    deps:
    - path: artifacts/mlflow_run_id.yaml
      hash: md5
      md5: c8e8230981775d33387ac84d35edbb14
      size: 233
    - path: config.yaml
      hash: md5
      md5: 8d4d5cd5045604148878deb449f33f6b
      size: 697
    - path: test.py
      hash: md5
      md5: 52c3f163e4e8f421be662a186e8f81fa
      size: 10652
    - path: training.py
      hash: md5
      md5: c6d4f9d8de340e625697ca2bbbca8ffa
      size: 7842
    params:
      config.yaml:
        data.data_folder: /home/data/data_data_assimilation/data_100_large
    outs:
    - path: artifacts/condition_numbers.png
      hash: md5
      md5: 9ed66a737bf198f89eef0ec0a1ef5853
      size: 43095
    - path: artifacts/preconditioning.png
      hash: md5
      md5: 5e42ae3c9ab57324cb79e3375236094b
      size: 186835
    - path: artifacts/sanity_check.png
      hash: md5
      md5: 8b33f5420428900355c53e70228c7439
      size: 43660
    - path: artifacts/svd_approximation.png
      hash: md5
      md5: bf38cfe4bed1de95faa415f21f23ca57
      size: 134637
