schema: '2.0'
stages:
  generate_data:
    cmd: python3.10 /home/prec_data/data_generation.py --config /home/smoke/config.yaml
    deps:
    - path: ../prec_data/data_generation.py
      md5: 41700b7d159c86ca16b0d9d547455548
      size: 4162
    params:
      config.yaml:
        data.data_path: /root/raw_data/data_100.pkl
        data.nsamples: 5000
        model.dimension: 100
        model.window: 10
    outs:
    - path: /root/raw_data/data_100.pkl
      md5: 19e71509c18e86099b17705ff10eaeee
      size: 4048570129
  train:
    cmd: source /home/.set_environment_variables.sh && python3.10 /home/smoke/training.py
      --config config.yaml --exp-name smoke_train_tr
    deps:
    - path: ../prec_data/data.py
      md5: dd5a7a9c868d112232ea829e845b389c
      size: 17066
    - path: /root/raw_data/data_100.pkl
      md5: 19e71509c18e86099b17705ff10eaeee
      size: 4048570129
    - path: config.yaml
      md5: 243628042b70ec34d277c9fed7c83a24
      size: 399
    - path: training.py
      md5: b55a5e60e13443c9a9120e629486ff02
      size: 4611
    params:
      config.yaml:
        architecture.batch_size: 8
        architecture.class: SVDConvolutional
        architecture.n_layers: 6
        architecture.rank: 50
        data.data_path: /root/raw_data/data_100.pkl
        model.dimension: 100
        optimizer.epochs: 100
    outs:
    - path: artifacts/metrics.yaml
      md5: c9cb594a7dd35b62b34b0763bafca26c
      size: 225
    - path: artifacts/mlflow_run_id.yaml
      md5: 2910353456c5849f25704788b7d08bc7
      size: 80
    - path: artifacts/training_logs.csv
      md5: a5d2a95c92c7c5a6d6bc8c579ef6616d
      size: 78011
  data_assim:
    cmd: source /home/.set_environment_variables.sh && python3.10 data_assimilation_benchmark.py
      --config config.yaml --run-id-yaml /home/smoke/artifacts/mlflow_run_id.yaml
    deps:
    - path: artifacts/mlflow_run_id.yaml
      md5: 2910353456c5849f25704788b7d08bc7
      size: 80
    - path: artifacts/training_logs.csv
      md5: a5d2a95c92c7c5a6d6bc8c579ef6616d
      size: 78011
    - path: config.yaml
      md5: 243628042b70ec34d277c9fed7c83a24
      size: 399
    - path: data_assimilation_benchmark.py
      md5: 367c74706158147ac9416199d52edf94
      size: 9114
    params:
      config.yaml:
        DA.n_cycle: 5
        DA.n_inner: 100
        DA.n_outer: 5
        model.window: 10
    outs:
    - path: artifacts/DA_logs.csv
      md5: 26e7dbcafb08197ec3bff13275539201
      size: 19145
    - path: artifacts/cond_niter_boxplot.png
      md5: 6af3c164b1ebf5e7c7f50362ec2c3e7a
      size: 31488
    - path: artifacts/res_inner_loop.png
      md5: c4d27a5d9b9d471a883fdfb646c7aa0d
      size: 324235
  test:
    cmd: source /home/.set_environment_variables.sh &&  python3.10 test.py --run-id-yaml
      /home/smoke/artifacts/mlflow_run_id.yaml
    deps:
    - path: artifacts/mlflow_run_id.yaml
      md5: 2910353456c5849f25704788b7d08bc7
      size: 80
    - path: config.yaml
      md5: 243628042b70ec34d277c9fed7c83a24
      size: 399
    - path: test.py
      md5: d6397d2ffe0d1338a14f237a46654dc3
      size: 8734
    - path: training.py
      md5: b55a5e60e13443c9a9120e629486ff02
      size: 4611
    params:
      config.yaml:
        data.data_path: /root/raw_data/data_100.pkl
    outs:
    - path: artifacts/condition_numbers.png
      md5: 3061bf807187f141174a7a19c2dcf3a4
      size: 30115
    - path: artifacts/preconditioning.png
      md5: 12e96ea7fca8fdc4154eac6f674ad6f8
      size: 193313
    - path: artifacts/sanity_check.png
      md5: 6fb681aa78f44d94865d4f87dfcecb8d
      size: 94657
    - path: artifacts/svd_approximation.png
      md5: 25f9a73b4596c8d399cd0df989bd98da
      size: 108195
