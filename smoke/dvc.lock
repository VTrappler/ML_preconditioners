schema: '2.0'
stages:
  generate_data:
    cmd: python3.10 /home/prec_data/data_generation.py --config /home/smoke/config.yaml
    deps:
    - path: ../prec_data/data_generation.py
      md5: 41700b7d159c86ca16b0d9d547455548
      size: 4162
    params:
      config.yaml:
        data.data_path: /root/raw_data/data_40.pkl
        data.nsamples: 10000
        model.dimension: 40
        model.window: 10
    outs:
    - path: /root/raw_data/data_40.pkl
      md5: 691d9377ad7ac53e1f4e1a695dfdeafe
      size: 1319540139
  train:
    cmd: source /home/.set_environment_variables.sh && python3.10 /home/smoke/training.py
      --config config.yaml --exp-name smoke_train_tr
    deps:
    - path: ../prec_data/data.py
      md5: d96748f579fbde3a0335c8b2f099fd3a
      size: 13355
    - path: /root/raw_data/data_40.pkl
      md5: 691d9377ad7ac53e1f4e1a695dfdeafe
      size: 1319540139
    - path: config.yaml
      md5: f020af963cf97c42b6d99c2fa338e55f
      size: 397
    - path: training.py
      md5: 926a0a6b0ab8a83688e8f45c71ba0f9b
      size: 4576
    params:
      config.yaml:
        architecture.batch_size: 32
        architecture.class: SVDConvolutional
        architecture.n_layers: 6
        architecture.rank: 30
        data.data_path: /root/raw_data/data_40.pkl
        model.dimension: 40
        optimizer.epochs: 200
    outs:
    - path: artifacts/metrics.yaml
      md5: 73b6442d4da55299f85b5abe6936ac22
      size: 222
    - path: artifacts/mlflow_run_id.yaml
      md5: f8e202a8882f92957b95f39bb9059baa
      size: 79
    - path: artifacts/training_logs.csv
      md5: 644b0e6b2d950e54de7b5dd955ce9e5c
      size: 85638
  data_assim:
    cmd: source /home/.set_environment_variables.sh && python3.10 data_assimilation_benchmark.py
      --config config.yaml --run-id-yaml /home/smoke/artifacts/mlflow_run_id.yaml
    deps:
    - path: artifacts/mlflow_run_id.yaml
      md5: f8e202a8882f92957b95f39bb9059baa
      size: 79
    - path: artifacts/training_logs.csv
      md5: 644b0e6b2d950e54de7b5dd955ce9e5c
      size: 85638
    - path: config.yaml
      md5: f020af963cf97c42b6d99c2fa338e55f
      size: 397
    - path: data_assimilation_benchmark.py
      md5: a90e12cb6de5815f1e4199f59a231f34
      size: 8090
    params:
      config.yaml:
        DA.n_cycle: 5
        DA.n_inner: 100
        DA.n_outer: 5
        model.window: 10
    outs:
    - path: artifacts/DA_logs.csv
      md5: 84a3b7c8288d6c8d8f1c885630667f18
      size: 13309
    - path: artifacts/res_inner_loop.png
      md5: ebadfddc172cb4623142606495740001
      size: 153842
  test:
    cmd: source /home/.set_environment_variables.sh &&  python3.10 test.py --run-id-yaml
      /home/smoke/artifacts/mlflow_run_id.yaml
    deps:
    - path: artifacts/mlflow_run_id.yaml
      md5: f8e202a8882f92957b95f39bb9059baa
      size: 79
    - path: config.yaml
      md5: f020af963cf97c42b6d99c2fa338e55f
      size: 397
    - path: test.py
      md5: b4e6fde4960aaa2b1cfd5e61f898f8b1
      size: 7662
    - path: training.py
      md5: 926a0a6b0ab8a83688e8f45c71ba0f9b
      size: 4576
    params:
      config.yaml:
        data.data_path: /root/raw_data/data_40.pkl
    outs:
    - path: artifacts/condition_numbers.png
      md5: 74d1f9a558db118ee7f43e5c6905d1f8
      size: 34296
    - path: artifacts/preconditioning.png
      md5: 7d1099fb67b26f72a8ff98047821b216
      size: 82061
    - path: artifacts/sanity_check.png
      md5: b5371a2f5382907de10f3c71f1a60492
      size: 64494
    - path: artifacts/svd_approximation.png
      md5: 8ab97581084103dac0f0680d0234f208
      size: 97383
