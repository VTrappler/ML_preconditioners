schema: '2.0'
stages:
  generate_data:
    cmd: python3.10 /home/prec_data/data_generation.py --config /home/smoke/config.yaml
    deps:
    - path: ../prec_data/data_generation.py
      md5: 41700b7d159c86ca16b0d9d547455548
      size: 4162
    params:
      config.yaml:
        data.data_path: /root/raw_data/data_100.pkl
        data.nsamples: 5000
        model.dimension: 100
        model.window: 10
    outs:
    - path: /root/raw_data/data_100.pkl
      md5: 19e71509c18e86099b17705ff10eaeee
      size: 4048570129
  train:
    cmd: source /home/.set_environment_variables.sh && python3.10 /home/smoke/training.py
      --config config.yaml --exp-name smoke_train_tr
    deps:
    - path: ../prec_data/data.py
      md5: dd5a7a9c868d112232ea829e845b389c
      size: 17066
    - path: /root/raw_data/data_100.pkl
      md5: 19e71509c18e86099b17705ff10eaeee
      size: 4048570129
    - path: config.yaml
      md5: 4e7f55a3e650e95d2f44178a3fb98fe9
      size: 392
    - path: training.py
      md5: 1775603cb8fea4ca0165f081ef547c23
      size: 4604
    params:
      config.yaml:
        architecture.batch_size: 8
        architecture.class: LMPLinOp
        architecture.n_layers: 6
        architecture.rank: 25
        data.data_path: /root/raw_data/data_100.pkl
        model.dimension: 100
        optimizer.epochs: 50
    outs:
    - path: artifacts/metrics.yaml
      md5: 9841ce8d806634dff5019b29c1a76670
      size: 370
    - path: artifacts/mlflow_run_id.yaml
      md5: 243731a2ec7b016db077637884752f72
      size: 80
    - path: artifacts/training_logs.csv
      md5: e1ab879a723e07f0a9491c6b0b063fb0
      size: 57084
  data_assim:
    cmd: source /home/.set_environment_variables.sh && python3.10 data_assimilation_benchmark.py
      --config config.yaml --run-id-yaml /home/smoke/artifacts/mlflow_run_id.yaml
    deps:
    - path: artifacts/mlflow_run_id.yaml
      md5: 243731a2ec7b016db077637884752f72
      size: 80
    - path: artifacts/training_logs.csv
      md5: e1ab879a723e07f0a9491c6b0b063fb0
      size: 57084
    - path: config.yaml
      md5: 4e7f55a3e650e95d2f44178a3fb98fe9
      size: 392
    - path: data_assimilation_benchmark.py
      md5: 421f1b1b74e4c4bdb9d4a84a39fb921c
      size: 8290
    params:
      config.yaml:
        DA.n_cycle: 5
        DA.n_inner: 100
        DA.n_outer: 5
        model.window: 10
    outs:
    - path: artifacts/DA_logs.csv
      md5: b4bbbd4d8cebbeb643601cfb004810e2
      size: 10787
    - path: artifacts/res_inner_loop.png
      md5: 7293b2b8f043d43840e149c5db09ba12
      size: 222559
  test:
    cmd: source /home/.set_environment_variables.sh &&  python3.10 test.py --run-id-yaml
      /home/smoke/artifacts/mlflow_run_id.yaml
    deps:
    - path: artifacts/mlflow_run_id.yaml
      md5: 243731a2ec7b016db077637884752f72
      size: 80
    - path: config.yaml
      md5: 4e7f55a3e650e95d2f44178a3fb98fe9
      size: 392
    - path: test.py
      md5: d2a5fed4b4f0d23e14c73e88a7ae4208
      size: 8619
    - path: training.py
      md5: 1775603cb8fea4ca0165f081ef547c23
      size: 4604
    params:
      config.yaml:
        data.data_path: /root/raw_data/data_100.pkl
    outs:
    - path: artifacts/condition_numbers.png
      md5: 2b00dbba674b876302344cd79a10c9df
      size: 34598
    - path: artifacts/preconditioning.png
      md5: 88555ffd58d85d74d20a4f0446ecfae3
      size: 164265
    - path: artifacts/sanity_check.png
      md5: f7086eeb55df5b08cf93c170aedffc2c
      size: 29210
